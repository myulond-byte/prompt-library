# 要件定義 - 初回指示書

## 📅 日付
2023年頃（推定）

## 👤 依頼者
細矢ますゆき様

---

## 📋 指示書の内容

### ■□■　指示書　■□■

**ＳＲＣ参加者様対応用の登録フォーム作業作成について**

---

## 🎯 目的

現状、ＳＲＣ参加者さまが発生した場合、似たような３つの作業が行われている。
それを一つにしたい。

### 現状の課題
```
参加者発生時に必要な作業:
1. エキスパフォーム①に登録
2. エキスパフォーム②に登録
3. 納品システムDBに登録

→ 手動で3回作業が必要
→ 時間がかかる
→ ミスが発生する可能性
```

### 目指す姿
```
参加者発生時:
1. 統合フォームに1回入力
   ↓
2. 自動で3箇所に登録
   ↓
3. 完了
```

---

## 📝 開発内容

### ■一つ目：自動登録機能

**一つのフォームを作成いただき、そのフォームメールアドレスが登録されたら**

#### 即座に実行される処理
```
以下のエキスパフォームに即登録される:
https://canyon-ex.jp/fx2246/lLnYf8
```

#### 日曜23時に実行される処理
```
以下の２つのフォームに最初に訪れる日曜日の
午後２３時に登録される

※登録日が日曜日であればその日曜日も含む

1. https://canyon-ex.jp/fx2246/IOo7YL
2. ＳＲＣ２０２０年納品システム　ID:ezwf
```

---

### ■二つ目：通知メール機能

**登録アドレス情報が、以下のアドレスへ以下の内容が通知される**

```
----------------------
メアド: support@src.mods.jp
件名: ＳＲＣ参加者登録情報
内容: アドレスの一覧＋登録時間
----------------------
```

---

## 📚 補足情報

### 1. 入金後（受信確認）
```
URL: https://canyon-ex.jp/fx2246/lLnYf8

【目的】
単なる受信確認

【フォームの作業内容】
- ＳＲＣ新システムエキスパ登録
- 個別コンサルへのバックエンド追加
```

### 2. 追加メルマガ
```
URL: https://canyon-ex.jp/fx2246/IOo7YL

【目的】
各メルマガへの登録作業

【フォームの作業内容】
- ＳＲＣ参加者さま → ＳＲＣ参加者限定
- ＳＲＣと競売 → オフ会
- にこにこ本舗メルマガ → メルマガ
```

### 3. ■日曜日に登録
```
URL: http://src-nouhin.raindrop.jp/_admin/

【ログイン情報】
ID: nouhin
PASS: hosoya789

【目的】
ＳＲＣ２０２０年納品システムに登録される　ID:ezwf

【フォームの作業内容】
納品作業対応
```

---

## 🎯 要件のまとめ

### 機能要件

#### 1. 統合フォーム
- [ ] メールアドレス入力フォーム作成
- [ ] 入力バリデーション
- [ ] 重複チェック機能

#### 2. 即時登録処理
- [ ] エキスパフォーム①へのAPI連携
- [ ] 登録成功/失敗のハンドリング

#### 3. 予約登録処理
- [ ] データベースへの一時保存
- [ ] 次の日曜日の計算ロジック
- [ ] 日曜日判定（当日含む）

#### 4. 週次バッチ処理
- [ ] 毎週日曜23時の自動実行（Cron設定）
- [ ] エキスパフォーム②への自動登録
- [ ] 納品システムへの自動登録
- [ ] 処理済みフラグの更新

#### 5. 通知機能
- [ ] 完了報告メールの自動送信
- [ ] 登録内容の一覧表示
- [ ] 登録時間の記録

---

## 🔍 技術的な検討事項

### 日曜日の判定ロジック
```php
// 例: PHPでの実装イメージ

// 現在の日付を取得
$today = new DateTime();
$dayOfWeek = $today->format('w'); // 0=日曜, 1=月曜, ...

if ($dayOfWeek == 0) {
    // 今日が日曜日なら、今日の23時
    $nextSunday = $today;
} else {
    // 次の日曜日を計算
    $daysUntilSunday = 7 - $dayOfWeek;
    $nextSunday = $today->modify("+{$daysUntilSunday} days");
}

// 23時に設定
$executionTime = $nextSunday->setTime(23, 0, 0);
```

### エキスパAPI連携
```
【必要な情報】
- APIキー
- APIエンドポイント
- フォームID
- 連携メルマガID

【エラーハンドリング】
- API通信エラー
- 認証エラー
- データ形式エラー
- リトライ処理
```

---

## 📊 期待される効果

### 業務効率化
```
Before:
- 1人あたり約5分の手作業
- 月50人登録の場合: 250分（約4時間）
- ヒューマンエラーのリスク

After:
- 完全自動化
- 作業時間: 0分
- ミスの撲滅
```

### システムの利点
✅ 作業時間の削減
✅ 登録ミスの防止
✅ 3システムの完全同期
✅ 週次配信の統一
✅ サポート対応の効率化

---

## 🎓 背景情報: なぜ「日曜日」なのか？

### SRCプログラムの特徴
```
【配信スケジュール】
17週間の週次プログラム
- Week 1: 初回コンテンツ
- Week 2: 2週目コンテンツ
- ...
- Week 17: 最終コンテンツ

【配信タイミング】
毎週月曜日 20時

【日曜スタートの理由】
全参加者を「同じWeek」で統一
→ コミュニティの一体感
→ サポート対応の効率化
→ 「今週はWeek 5ですね」と言える
```

---

## 📋 開発スコープ

### Phase 1: 必須機能
- [x] 統合フォーム作成
- [x] 即時登録処理（フォーム①）
- [x] データベース設計
- [x] 週次バッチ処理
- [x] エキスパAPI連携（フォーム②③）
- [x] 納品システム連携
- [x] 通知メール機能

### Phase 2: オプション機能
- [x] 管理画面（ユーザー一覧）
- [x] 手動登録機能（突発対応用）
- [x] ログ記録
- [x] エラーハンドリング

---

## 💰 見積もり

```
【開発者からの見積もり】
費用: 2万円

【含まれる内容】
- メールアドレス登録フォーム
- 登録後の最初の日曜日に一括登録
- エキスパのメルマガに自動登録
- 自動登録実施後の完了報告メール
```

---

## 🚀 想定スケジュール

```
Week 1: 要件定義・設計
Week 2-3: 開発
Week 4: テスト・調整
Week 5: 納品・マニュアル作成
```

---

## ✅ 成功基準

- [ ] フォームから登録すると3システムに自動登録される
- [ ] 日曜23時にバッチ処理が実行される
- [ ] 完了報告メールが送信される
- [ ] 重複登録が防止される
- [ ] エラーが発生しても適切に処理される

---

## 📝 備考

### クライアントの期待
```
「面倒な手作業を自動化したい」
「ミスをなくしたい」
「時間を節約したい」
```

### 開発者の理解
```
「週次配信の統一が重要」
「日曜スタートに揃える意図を理解」
「3システムの完全同期が必須」
```

---

**作成日: 2023年頃**
**最終更新: 2025年2月6日（アーカイブ化）**
