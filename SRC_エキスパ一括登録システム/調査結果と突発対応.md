# 開発やりとり - 調査結果と突発対応

## 📅 やりとり記録

---

## 1️⃣ 初回確認（MNSと突発の件）

### 📧 開発者（高橋様）からの確認メール

```
お世話になります。

本日細矢様からご依頼のあった「MNS」の件ですが、
改めて確認しましたところ以前大場様よりご依頼いただいた
「突発」の件と同じ内容と思われますが、この点いかがでしょうか？

メルマガ：ＳＲＣ２０２０年納品システム
納品用URL：http://src.ciao.jp/campaign/?mail=%%Email%%

このURLをクリックした際に参照するデータベースは、
http://src-nouhin.raindrop.jp/_admin/
の画面から登録しているデータベースです。（以下、納品DBとします）

エキスパに登録されメルマガは配信されているものの、
納品DBに未登録のために納品画面を開くことができない、
という現象と想定しております。

これを解消するのが、以前ご提示したサンプルプログラムです。
http://src-nouhin.raindrop.jp/_admin/regist2.php

エキスパに登録した日（もしくは任意の日付）とメールアドレスを
上記フォームより登録することで、エキスパ側と納品DBを連携させることが
できるようになります。

私の認識が違っている場合には改めてご指示頂けますと幸いです。
宜しくお願い致します。
```

### 📌 ポイント
- 「突発」という問題が発生していた
- エキスパには登録されているが納品DBに未登録
- 原因: 通常の一括登録フローを経由せずに直接登録

---

## 2️⃣ 調査結果報告

### 📧 開発者（高橋様）からの調査報告

```
■調査結果

当初の仕様では、http://src-nouhin.raindrop.jp/_admin/ より
メールアドレスを登録していただくと、納品システム側DBと
エキスパの「ＳＲＣ２０２０年納品システム」の両方に登録される
仕組みとなっておりました。

納品の際は、エキスパではなく納品システム側DBに登録された
メールアドレスを使って認証し、納品スケジュールを取得して
納品するようになっております。

突発および突発２ですが、エキスパにて直接登録されているため
メルマガは配信されますが、納品システム側DBにはメールアドレスおよび
納品スケジュールが登録されておりません。
そのため、突発／突発２の登録者に納品できない状況です。
```

### 🔍 問題の詳細

#### 通常フロー
```
一括登録システム
  ↓
エキスパ + 納品DB 両方に登録 ✅
  ↓
メルマガ配信 ✅
  ↓
納品URL → 納品DB認証 → コンテンツ表示 ✅
```

#### 突発ケースの問題
```
エキスパに直接登録（何らかの理由）
  ↓
エキスパのみ登録 ⚠️
  ↓
メルマガ配信 ✅
  ↓
納品URL → 納品DB認証 → エラー ❌
（納品DBにデータがないため認証失敗）
```

---

## 3️⃣ 対応方法の提案

### 📧 開発者（高橋様）からの提案

```
■対応方法

対応についてですが、メルマガ登録をエキスパで直接行われているので
納品システム側だけにメールアドレスを登録するためのフォームを
別途用意するのが良いと考えております。

なお、エキスパに登録した日を起点としてキャンペーン開始日と終了日を
自動計算する仕組みになっておりますが、突発の場合はエキスパへの
登録がすでに行われた後になるはずです。

突発用登録フォームでは、別途「登録日」の項目を追加して
エキスパへの登録日を指定していただくことで、通常版と同じ流れで
納品日程を算出することを想定しています。
```

### 💡 解決策の設計

#### 突発対応フォームの仕様
```
【入力項目】
1. メールアドレス
2. 登録日（手動入力）

【処理内容】
1. 入力された登録日から納品スケジュールを計算
2. 納品DBにのみデータを追加
3. エキスパには登録しない（既に登録済みのため）

【メリット】
- 既存のエキスパ登録を維持
- 納品DBと同期が取れる
- 通常と同じ納品スケジュール
```

---

## 4️⃣ サンプルプログラムの提示

### 📧 開発者（高橋様）からのサンプル案内

```
■サンプルプログラム

サンプルプログラムを作成しましたので、動作をご確認頂けますと幸いです。
以下の流れで画面をご確認下さい。

1. http://src-nouhin.raindrop.jp/_admin/ よりログイン
2. ログインした状態で、http://src-nouhin.raindrop.jp/_admin/regist2.php を開く
3. Eメールと登録日を入力して、登録ボタンを押す

メールアドレスの登録は行いませんが、キャンペーンの開始日と終了日を
「登録日」から起算して自動計算した結果が表示されます。

この仕様で問題がなければ、メールアドレスとキャンペーン日程をDBに
登録する機能を実装します。

ご不明点がありましたらお知らせください。
宜しくお願い致します。
```

---

## 5️⃣ 見積もり提示

### 📧 開発者（高橋様）からの見積もり

```
お世話になっております。
ご返信が遅れまして申し訳ございません。

作業をご依頼いただきありがとうございます。
以下の機能を想定しておりますが、認識違いがないかご確認ください。

・メールアドレス登録フォームを用意

・登録後の最初の日曜日に、一括でエキスパのメルマガに登録する
  ※日曜日に登録した場合は、翌週日曜日にエキスパ登録を行う
  
・対象となるエキスパのメルマガは「ＳＲＣ２０２０年納品システム」とする

・自動登録実施後、登録件数を管理者宛にメールで報告する

上記以外で必要な要件がございましたらお知らせ下さい。
費用は2万円でいかがでしょうか。

ご検討のほど宜しくお願い致します。
```

### 💰 見積もり詳細

| 項目 | 内容 |
|------|------|
| 開発費用 | 20,000円 |
| 含まれる内容 | ・フォーム作成<br>・日曜日の自動登録<br>・エキスパ連携<br>・完了報告メール |
| 納期 | 相談（数週間程度と推定） |

---

## 6️⃣ 開発完了と納品

### 📦 納品物

#### 1. エキスパフォーム一括登録システム
```
URL: http://src-nouhin.raindrop.jp/_ikkatu/

【機能】
- メールアドレス登録フォーム
- 次の日曜23時の自動登録予約
- 重複チェック
- 登録予定日の表示
```

#### 2. 週次バッチ処理
```
実行タイミング: 毎週日曜 23:00
実行スクリプト: auto_regist.php

【処理内容】
- エキスパ3フォームへの自動登録
- 納品システムへの登録
- 完了報告メールの送信
```

#### 3. 突発対応フォーム
```
URL: http://src-nouhin.raindrop.jp/_admin/regist2.php

【機能】
- 既存エキスパ登録者の補完
- 登録日の手動指定
- 納品スケジュールの計算
```

#### 4. マニュアル
```
ファイル名: エキスパフォーム一括登録システム_マニュアル.pdf
作成日: 2023年3月
バージョン: Rev. 1.0

【内容】
- 各種アカウント情報
- ログイン方法
- 操作手順
- システム構成図
```

---

## 📊 開発の流れ（タイムライン）

```
Week 1: 要件確認
  ├─ 初回指示書の受領
  ├─ 仕様の確認
  └─ 見積もり提示（2万円）

Week 2: 開発開始
  ├─ フォーム作成
  ├─ データベース設計
  └─ API連携実装

Week 3: 突発問題の発生
  ├─ エキスパ直接登録のケース判明
  ├─ 問題の調査
  └─ 対応策の検討

Week 4: 突発対応の開発
  ├─ regist2.php の作成
  ├─ サンプル提示
  └─ 承認

Week 5: テスト・調整
  ├─ 動作確認
  ├─ バグ修正
  └─ 最終チェック

Week 6: 納品
  ├─ システム納品
  ├─ マニュアル作成
  └─ 運用開始
```

---

## 🎯 開発のポイント

### 成功要因
✅ 要件の明確化
✅ 週次配信の設計意図を理解
✅ 突発ケースへの柔軟な対応
✅ 丁寧なコミュニケーション
✅ マニュアル完備

### 課題と対応
⚠️ 突発ケースの発生
→ 補完フォームで対応

⚠️ エキスパとの同期
→ API連携で自動化

⚠️ 日曜日の判定ロジック
→ サンプルで確認

---

## 📝 コミュニケーションの特徴

### 開発者（高橋様）の対応
```
✅ 丁寧な確認
✅ 問題の的確な調査
✅ 代替案の提示
✅ サンプルでの検証
✅ 分かりやすい説明
```

### プロジェクト管理（大場様）の役割
```
✅ クライアントとの窓口
✅ 要件の取りまとめ
✅ 承認・判断
✅ 進行管理
```

---

## 💡 学んだこと

### 技術的な知見
```
1. エキスパAPIの連携方法
2. 週次バッチ処理の実装
3. データベース同期の重要性
4. エラーケースへの対応
```

### プロジェクト管理
```
1. 要件定義の重要性
2. イレギュラーケースの想定
3. 段階的な開発とテスト
4. マニュアル作成の必要性
```

---

## 🔧 保守・運用への引き継ぎ

### 重要な情報
```
【システム】
- 一括登録: http://src-nouhin.raindrop.jp/_ikkatu/
- 突発対応: http://src-nouhin.raindrop.jp/_admin/regist2.php

【Cron設定】
- 毎週日曜 23:00
- auto_regist.php

【エキスパ】
- フォーム①: /fx2246/lLnYf8
- フォーム②: /fx2246/IOo7YL
- フォーム③: /fx2246/n5GgUQ

【通知先】
- support@src.mods.jp
```

---

## ✅ 成果物チェックリスト

- [x] 一括登録フォーム
- [x] 週次バッチ処理
- [x] エキスパAPI連携
- [x] 納品システム連携
- [x] 突発対応フォーム
- [x] 完了報告メール機能
- [x] マニュアル作成
- [x] システム構成図
- [x] アカウント情報整理

---

**作成日: 2023年頃**
**最終更新: 2025年2月6日（アーカイブ化）**
